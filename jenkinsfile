pipeline{
    agent any
     stages{
        stage("Hello Word"){
            steps{
                echo "Hello Word This is Beautifull word and i really enjoying to leave here"
                echo "Addedd to new build"
            }
        }
      stage("Ansible login"){
         steps{
           sshPublisher(publishers: [sshPublisherDesc(configName: 'Ansible-Server', transfers: [sshTransfer(cleanRemote: false, excludes: '', execCommand: 'rsync -avh /var/lib/jenkins/workspace/pipelintest/Dockerfile  root@172.31.31.78:/opt', execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: '[, ]+', remoteDirectory: '', remoteDirectorySDF: false, removePrefix: '', sourceFiles: '')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])
         }
      }
      stage("Docker Build and Push"){
         steps{
            sh 'cd /opt'
            sh 'docker image build -t ${JOB_NAME}:v1.${BUILD_ID} .'
            sh 'docker image tag ${JOB_NAME}:v1.${BUILD_ID}  luckyparmar/${JOB_NAME}:v1.${BUILD_ID}'
            sh 'docker image tag ${JOB_NAME}:v1.${BUILD_ID}  luckyparmar/${JOB_NAME}:latest'
         }
      }
    }
}
